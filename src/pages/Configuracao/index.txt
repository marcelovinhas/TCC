import React, { useRef, useState, useEffect } from 'react';
import { useSelector, useDispatch } from 'react-redux';
import { useNavigation } from '@react-navigation/native';
import { StyleSheet, View, TouchableOpacity } from 'react-native';
import Icon from 'react-native-vector-icons/MaterialIcons';

import { Background } from '../../components/Background';
import { signOut } from '../../store/modules/auth/actions';
import { updateProfileRequest } from '../../store/modules/usuario/actions';

import {
  Caixa,
  Text,
  Nome,
  // Sobrenome,
  TextInput,
  Usuario,
  Senha,
  SenhaAntiga,
  ConfirmarSenha,
  SairBotao,
  SairTexto,
  SalvarBotao,
  SalvarTexto,
} from './styles';

export default function Configuracao() {
  const dispatch = useDispatch();
  const navigation = useNavigation();
  const profile = useSelector((state) => state.usuario);

  // const usuarioRef = useRef();
  const emailRef = useRef();
  const senhaAntigaRef = useRef();
  const senhaRef = useRef();
  const confirmarSenhaRef = useRef();

  const [nome, setNome] = useState(profile.nome); // falta colocar profile.name
  // const [sobrenome, setSobrenome] = useState('');
  // const [usuario, setUsuario] = useState('');
  const [email, setEmail] = useState(profile.email);
  const [senhaAntiga, setSenhaAntiga] = useState('');
  const [senha, setSenha] = useState('');
  const [confirmarSenha, setConfirmarSenha] = useState('');

  useEffect(() => {
    setSenhaAntiga('');
    setSenha('');
    setConfirmarSenha('');
  }, [profile]);

  function handleSubmit() {
    dispatch(
      updateProfileRequest({
        nome,
        email,
        senhaAntiga,
        senha,
        confirmarSenha,
      })
    );
  }
  function handleLogout() {
    dispatch(signOut());
  }

  // function handleLogout() {
  //   dispatch(signOut());
  //   CommonActions.reset({
  //     index: 0,
  //     routes: [{ name: 'Login' }],
  //   });
  // }

  return (
    <Background>
      <Caixa>
        <View style={styles.superiorHeader}>
          <Text style={styles.superiorTitle}>Configuracoes</Text>
          <TouchableOpacity onPress={() => navigation.navigate('Inicial')}>
            <Icon
              style={{ marginLeft: 150, marginRight: 5, marginTop: 20 }}
              name="home"
              color="#FFF"
              size={40}
              // style={{height:60,width:60}}
            />
          </TouchableOpacity>
        </View>
      </Caixa>

      <Text>Editar perfil</Text>
      <Nome>
        <TextInput
          icon="sentiment-satisfied"
          autoCorrect={false} // não corrige o email automaticamente
          autoCapitalize="words"
          placeholder="Nome"
          returnKeyType="next" // muda o botão de passar adiante do teclado
          onSubmitEditing={() => emailRef.current.focus()} // após clicar, já vai com o teclado aberto pro prox
          value={nome}
          onChangeText={setNome}
        />
      </Nome>

      {/* <Sobrenome>
        <TextInput
          icon="sentiment-satisfied"
          autoCorrect={false} // não corrige o email automaticamente
          autoCapitalize="words"
          placeholder="Sobrenome"
          returnKeyType="next" // muda o botão de passar adiante do teclado
          onSubmitEditing={() => usuarioRef.current.focus()} // após clicar, já vai com o teclado aberto pro prox
          ref={sobrenomeRef}
          value={sobrenome}
          onChangeText={setSobrenome}
        />
      </Sobrenome> */}

      <Usuario>
        <TextInput
          icon="person-outline"
          autoCorrect={false} // não corrige o email automaticamente
          autoCapitalize="none" // não coloca letra maiúscula
          placeholder="Email"
          returnKeyType="next" // muda o botão de passar adiante do teclado
          onSubmitEditing={() => senhaAntigaRef.current.focus()} // após clicar, já vai com o teclado aberto pro prox
          ref={emailRef}
          value={email}
          onChangeText={setEmail}
        />
      </Usuario>

      <Text>Trocar senha</Text>
      <SenhaAntiga>
        <TextInput
          icon="lock-open"
          placeholder="Senha antiga"
          returnKeyType="next" // muda o botão de passar adiante do teclado
          onSubmitEditing={() => senhaRef.current.focus()} // após clicar, já vai com o teclado aberto pro prox
          ref={senhaAntigaRef}
          value={senhaAntiga}
          onChangeText={setSenhaAntiga}
        />
      </SenhaAntiga>

      <Senha>
        <TextInput
          icon="lock-outline"
          secureTextEntry // não mostra o texto
          placeholder="Nova senha"
          returnKeyType="next"
          onSubmitEditing={() => confirmarSenhaRef.current.focus()} // após clicar, já vai com o teclado aberto pro prox
          ref={senhaRef}
          value={senha}
          onChangeText={setSenha}
        />
      </Senha>

      <ConfirmarSenha>
        <TextInput
          icon="lock"
          secureTextEntry // não mostra o texto
          placeholder="Confirmar nova senha"
          returnKeyType="next"
          // onSubmitEditing={() => confirmarSenhaRef.current.focus()} // após clicar, já vai com o teclado aberto pro prox
          ref={confirmarSenhaRef}
          value={confirmarSenha}
          onChangeText={setConfirmarSenha}
        />
      </ConfirmarSenha>

      <SairBotao onPress={handleLogout}>
        <SairTexto>Sair</SairTexto>
      </SairBotao>

      <SalvarBotao onPress={handleSubmit}>
        <SalvarTexto>Salvar</SalvarTexto>
      </SalvarBotao>
    </Background>
  );
}

const styles = StyleSheet.create({
  superiorTitle: {
    // backgroundColor: '#dae2ed',
    marginTop: 30,
    alignItems: 'center',
    justifyContent: 'center',
    marginLeft: 10,
    marginRight: 10,
    height: 40,
    borderRadius: 5,
    color: '#FFF',
    fontSize: 25,
  },
  superiorHeader: {
    flexDirection: 'row',
  },
});
